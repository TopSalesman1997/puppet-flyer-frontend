!function(){"use strict";function e(){const e=window.fbDb;if(!e)throw new Error("Firestore (window.fbDb) not initialized. Make sure firebase-client.js runs before script.js.");return e}function t(){const e=window.fbFs;if(!e)throw new Error("Firestore helpers (window.fbFs) not initialized. Make sure firebase-client.js sets window.fbFs.");return e}function n(e){return e?String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]||e)):""}async function o(o="weekly"){console.log("loadLeaderboard started for period:",o);const s=document.getElementById("leaderboard-list"),i=document.getElementById("btn-weekly"),r=document.getElementById("btn-monthly"),l=document.getElementById("btn-alltime");if(s){[i,r,l].forEach(e=>e?.classList.remove("active")),"weekly"===o?i?.classList.add("active"):"monthly"===o?r?.classList.add("active"):"alltime"===o&&l?.classList.add("active"),s.innerHTML='<li style="text-align:center; color:#888;">Loading...</li>';try{const i=e(),{collection:r,query:l,where:a,orderBy:d,limit:c,getDocs:y,Timestamp:m}=t(),f=r(i,"leaderboard");let u,p=10;if("weekly"===o||"monthly"===o){const e=new Date;"weekly"===o?e.setDate(e.getDate()-7):e.setMonth(e.getMonth()-1),p=100,u=l(f,a("timestamp",">=",m.fromDate(e)),d("timestamp","desc"),c(p))}else u=l(f,d("score","desc"),d("timestamp","desc"),c(10));const w=await y(u);if(!w||w.empty)return void(s.innerHTML='<li style="text-align:center; color:#888;">No scores yet</li>');const g=[];w.forEach(e=>{const t=e.data();t&&g.push(t)}),"weekly"!==o&&"monthly"!==o||(g.sort((e,t)=>{const n=e.score||0,o=t.score||0;if(o!==n)return o-n;const s=e.timestamp&&"function"==typeof e.timestamp.toMillis?e.timestamp.toMillis():0;return(t.timestamp&&"function"==typeof t.timestamp.toMillis?t.timestamp.toMillis():0)-s}),g.length>10&&g.splice(10)),s.innerHTML="",g.forEach((e,t)=>{const o=document.createElement("li");o.className="leaderboard-row",o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.padding="8px 12px",o.innerHTML=`\n        <span style="flex:1; text-align:left;">${t+1}. ${n(e.username||"Anonymous")}</span>\n        <span style="width:80px; text-align:right; font-weight:700;">${Number(e.score||0)}</span>\n      `,s.appendChild(o)}),console.log("loadLeaderboard completed")}catch(e){console.error("Error loading leaderboard:",e),s.innerHTML='<li style="text-align:center; color:#c00;">Error loading leaderboard</li>'}}else console.warn("No #leaderboard-list element found; aborting loadLeaderboard.")}window.addEventListener("DOMContentLoaded",()=>{if(console.log("script.js loaded"),window.fbDb&&window.fbAuth&&window.fbFs){try{o("weekly")}catch(e){console.error("loadLeaderboard immediate call failed:",e)}return}const e=()=>{window.removeEventListener("firebase-ready",e);try{o("weekly")}catch(e){console.error("loadLeaderboard after firebase-ready failed:",e)}};window.addEventListener("firebase-ready",e)}),window.loadLeaderboard=o,window.loadPlayerStats=async function(){let o,s,i;try{o=function(){const e=window.fbAuth;if(!e)throw new Error("Auth (window.fbAuth) not initialized. Make sure firebase-client.js runs before script.js.");return e}(),s=e(),i=t()}catch(e){console.error("Firebase not initialized for loadPlayerStats:",e);const t=document.getElementById("user-stats-status");return void(t&&(t.textContent="Firebase not initialized.",t.style.display="block"))}const{doc:r,getDoc:l}=i,a=document.getElementById("user-stats-title"),d=document.getElementById("user-stats-status"),c=document.getElementById("user-stats-list"),y=document.getElementById("user-total-score"),m=o.currentUser;if(!m)return a&&(a.textContent="Player Stats"),d&&(d.textContent="Sign in to see your stats.",d.style.display="block"),c&&(c.innerHTML=""),void(y&&(y.textContent="Total Score: 0"));try{const e=r(s,"users",m.uid),t=await l(e);let o=m.email||"Player";if(t&&t.exists()){o=t.data().username||m.email||o}a&&(a.textContent=`${o}'s Top Scores`);const i=r(s,"userStats",m.uid),f=await l(i);if(!f||!f.exists())return d&&(d.textContent="No games played yet.",d.style.display="block"),c&&(c.innerHTML=""),void(y&&(y.textContent="Total Score: 0"));const u=f.data(),p=Array.isArray(u.scores)?u.scores:[],w=Number(u.totalScore||0);if(d&&(d.style.display="none"),c)if(c.innerHTML="",0===p.length){const e=document.createElement("li");e.style.textAlign="center",e.style.color="#888",e.textContent="No scores yet",c.appendChild(e)}else p.forEach((e,t)=>{const o=document.createElement("li");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.padding="6px 10px";const s=`${e.date||""} ${e.time||""}`.trim();o.innerHTML=`\n            <span style="flex:1; text-align:left;">${t+1}. ${Number(e.score||0)}</span>\n            <span style="width:140px; text-align:right; font-size:11px; color:#666;">${n(s)}</span>\n          `,c.appendChild(o)});if(y){const e=p.length,t=e>0?w/e:0,n=Number.isInteger(t)?t.toString():t.toFixed(2);y.innerHTML=`\n        <div style="display:flex; justify-content:space-between; align-items:center; gap:16px; font-weight:700;">\n          <div style="flex:1; text-align:left;  font-size:14px;">Games: ${e}</div>\n          <div style="flex:1; text-align:center; font-size:14px;">Total Score: ${w}</div>\n          <div style="flex:1; text-align:right; font-size:14px;">Avg. Score: ${n}</div>\n        </div>\n      `}}catch(e){console.error("Error loading player stats:",e),d&&(d.textContent="Error loading stats.",d.style.display="block")}}}();
//# sourceMappingURL=script.bundle.js.map
