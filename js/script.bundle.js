!function(){"use strict";function e(){const e=window.fbDb;if(!e)throw new Error("Firestore (window.fbDb) not initialized. Make sure firebase-client.js runs before script.js.");return e}function t(){const e=window.fbFs;if(!e)throw new Error("Firestore helpers (window.fbFs) not initialized. Make sure firebase-client.js sets window.fbFs.");return e}function n(e){return e?String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]||e)):""}async function o(o="weekly"){console.log("loadLeaderboard started for period:",o);const s=document.getElementById("leaderboard-list"),r=document.getElementById("btn-weekly"),i=document.getElementById("btn-monthly"),a=document.getElementById("btn-alltime");if(s){[r,i,a].forEach(e=>e?.classList.remove("active")),"weekly"===o?r?.classList.add("active"):"monthly"===o?i?.classList.add("active"):"alltime"===o&&a?.classList.add("active"),s.innerHTML='<li style="text-align:center; color:#888;">Loading...</li>';try{const r=e(),{collection:i,query:a,where:l,orderBy:d,limit:c,getDocs:y,Timestamp:f}=t(),m=i(r,"leaderboard");let u;if("weekly"===o||"monthly"===o){const e=new Date;"weekly"===o?e.setDate(e.getDate()-7):e.setMonth(e.getMonth()-1),u=a(m,l("timestamp",">=",f.fromDate(e)),d("score","desc"),d("timestamp","desc"),c(10))}else u=a(m,d("score","desc"),d("timestamp","desc"),c(10));const w=await y(u);if(!w||w.empty)return void(s.innerHTML='<li style="text-align:center; color:#888;">No scores yet</li>');const p=[];w.forEach(e=>{const t=e.data();t&&p.push(t)}),s.innerHTML="",p.forEach((e,t)=>{const o=document.createElement("li");o.className="leaderboard-row",o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.padding="8px 12px",o.innerHTML=`\n        <span style="flex:1; text-align:left;">${t+1}. ${n(e.username||"Anonymous")}</span>\n        <span style="width:80px; text-align:right; font-weight:700;">${Number(e.score||0)}</span>\n      `,s.appendChild(o)}),console.log("loadLeaderboard completed")}catch(e){console.error("FULL LEADERBOARD ERROR:",e),s.innerHTML='<li style="text-align:center; color:#c00;">Error loading leaderboard</li>'}}else console.warn("No #leaderboard-list element found; aborting loadLeaderboard.")}window.addEventListener("DOMContentLoaded",()=>{if(console.log("script.js loaded"),window.fbDb&&window.fbAuth&&window.fbFs){try{o("weekly")}catch(e){console.error("loadLeaderboard immediate call failed:",e)}return}const e=()=>{window.removeEventListener("firebase-ready",e);try{o("weekly")}catch(e){console.error("loadLeaderboard after firebase-ready failed:",e)}};window.addEventListener("firebase-ready",e)}),window.loadLeaderboard=o,window.loadPlayerStats=async function(){let o,s,r;try{o=function(){const e=window.fbAuth;if(!e)throw new Error("Auth (window.fbAuth) not initialized. Make sure firebase-client.js runs before script.js.");return e}(),s=e(),r=t()}catch(e){console.error("Firebase not initialized for loadPlayerStats:",e);const t=document.getElementById("user-stats-status");return void(t&&(t.textContent="Firebase not initialized.",t.style.display="block"))}const{doc:i,getDoc:a}=r,l=document.getElementById("user-stats-title"),d=document.getElementById("user-stats-status"),c=document.getElementById("user-stats-list"),y=document.getElementById("user-total-score"),f=o.currentUser;if(!f)return l&&(l.textContent="Player Stats"),d&&(d.textContent="Sign in to see your stats.",d.style.display="block"),c&&(c.innerHTML=""),void(y&&(y.textContent="Total Score: 0"));try{const e=i(s,"users",f.uid),t=await a(e);let o=f.email||"Player";if(t&&t.exists()){o=t.data().username||f.email||o}l&&(l.textContent=`${o}'s Top Scores`);const r=i(s,"userStats",f.uid),m=await a(r);if(!m||!m.exists())return d&&(d.textContent="No games played yet.",d.style.display="block"),c&&(c.innerHTML=""),void(y&&(y.textContent="Total Score: 0"));const u=m.data(),w=Array.isArray(u.scores)?u.scores:[],p=Number(u.totalScore||0);if(d&&(d.style.display="none"),c)if(c.innerHTML="",0===w.length){const e=document.createElement("li");e.style.textAlign="center",e.style.color="#888",e.textContent="No scores yet",c.appendChild(e)}else w.forEach((e,t)=>{const o=document.createElement("li");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.padding="6px 10px";const s=`${e.date||""} ${e.time||""}`.trim();o.innerHTML=`\n            <span style="flex:1; text-align:left;">${t+1}. ${Number(e.score||0)}</span>\n            <span style="width:140px; text-align:right; font-size:11px; color:#666;">${n(s)}</span>\n          `,c.appendChild(o)});if(y){const e=Number(u.gamesPlayed||w.length),t=(e>0?p/e:0).toFixed(2);y.innerHTML=`\n        <div style="display:flex; justify-content:space-between; align-items:center; gap:16px; font-weight:700;">\n          <div style="flex:1; text-align:left;  font-size:14px;">Games: ${e}</div>\n          <div style="flex:1; text-align:center; font-size:14px;">Total Score: ${p}</div>\n          <div style="flex:1; text-align:right; font-size:14px;">Avg. Score: ${t}</div>\n        </div>\n      `}}catch(e){console.error("Error loading player stats:",e),d&&(d.textContent="Error loading stats.",d.style.display="block")}}}();
//# sourceMappingURL=script.bundle.js.map
